var _=Object.defineProperty,A=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var q=(r,e,t)=>e in r?_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,u=(r,e)=>{for(var t in e||(e={}))N.call(e,t)&&q(r,t,e[t]);if(g)for(var t of g(e))T.call(e,t)&&q(r,t,e[t]);return r},v=(r,e)=>A(r,O(e));import{c as $,e as j,j as P,d as Q,t as R,f as x,a as B,h as E}from"./entry-48deebdc.mjs";import{u as I}from"./asyncData-f5342ae5.mjs";import{h as L,j as z,u as D}from"./json-e24838ca.mjs";import{w as F}from"./utils-6e6c89bd.mjs";const d=r=>Array.isArray(r)?r:r?[r]:[],G=["sort","where","only","without"],S=(r,e)=>{const t=u({},e);for(const n of G)t[n]&&(t[n]=d(t[n]));const o=(n,s)=>(...f)=>(t[n]=s(...f),a),a={params:()=>Object.freeze(t),only:o("only",d),without:o("without",d),where:o("where",n=>[...d(t.where),n]),sort:o("sort",n=>[...d(t.sort),...d(n)]),limit:o("limit",n=>parseInt(String(n),10)),skip:o("skip",n=>parseInt(String(n),10)),findOne:()=>r(v(u({},t),{first:!0})),find:()=>r(t),findSurround:(n,s)=>r(v(u({},t),{surround:u({query:n},s)})),locale:n=>a.where({_locale:n})};return a},k=r=>{const e=F(`/query/${L(r)}`);return $fetch(e,{method:"GET",responseType:"json",params:{_params:z(r),previewToken:D("previewToken").value}})};function J(r,...e){if(typeof r=="string"){const t=$(j(P(r,...e)));return S(k).where({_path:new RegExp(`^${t}`)})}return S(k,r)}var W=Q({props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(r){const{path:e,only:t,without:o,where:a,sort:n,limit:s,skip:f,locale:p,find:h}=R(r),y=x(()=>e.value.includes("/_")),{data:c,refresh:w}=await I(`content-doc-${e.value}`,()=>{let i=J();if(e.value){const l=$(j(e.value));i=i.where({_path:l})}return t.value&&(i=i.only(t.value)),o.value&&(i=i.without(o.value)),a.value&&(i=i.where(a.value)),n.value&&(i=i.sort(n.value)),s.value&&(i=i.limit(s.value)),f.value&&(i=i.skip(f.value)),p.value&&(i=i.where({_locale:p.value})),h.value==="one"?i.findOne():h.value==="surround"?e.value?i.findSurround(e):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),i.find()):i.find()});return{isPartial:y,data:c,refresh:w}},render(r){var m;const e=B(),{data:t,refresh:o,isPartial:a,path:n,only:s,without:f,where:p,sort:h,limit:y,skip:c,locale:w,find:i}=r,l={path:n,only:s,without:f,where:p,sort:h,limit:y,skip:c,locale:w,find:i};if(l.find==="one"){if(!t&&(e==null?void 0:e["not-found"]))return e["not-found"](u({props:l},this.$attrs));if(t._type&&t._type==="markdown"&&!((m=t==null?void 0:t.body)!=null&&m.children.length))return e.empty(u({props:l},this.$attrs))}else if((!t||!t.length)&&e!=null&&e["not-found"])return e["not-found"](u({props:l},this.$attrs));return e!=null&&e.default?e.default(u({data:t,refresh:o,isPartial:a,props:l},this.$attrs)):((C,b)=>E("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:C,data:b},null,2)))("default",{data:t,props:l,isPartial:a})}});export{W as default};
